function tcart__hideDeliveryPrice(){$(".t706__cartwin-totalamount-info").length&&$(".t706__cartwin-totalamount-info").css("opacity","0"),$(".t706 .delivery-full-address").length&&$(".t706 .delivery-full-address").css("opacity","0")}function tcart__showDeliveryPrice(){$(".t706__cartwin-totalamount-info").length&&$(".t706__cartwin-totalamount-info").css("opacity","1"),$(".t706 .delivery-full-address").length&&$(".t706 .delivery-full-address").css("opacity","1")}function arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function tcart__rerenderDeliveryServices(){clearTimeout(window.rerenderTimer),window.rerenderTimer=setTimeout(function(){$(".t706__cartwin-content .t706__product").css("pointer-events","none"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","none");var e=!1,t=tcart_newDelivery.deliveryState,r=t.services,a=t.activeServiceUid,i=tcart_newDelivery;if(!a)return $(".t706__cartwin-content .t706__product").css("pointer-events","unset"),void $(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset");var s=[],o=[];Object.keys(r).forEach(function(e){s.push(parseInt(e,10))}),$.when(tcart_newDelivery.getServices(t.projectId,t.cityPostalCode,t.currencyCode)).then(function(r){var d;(r.forEach(function(e){o.push(e.id)}),s.sort(function(e,t){return e-t}),o.sort(function(e,t){return e-t}),e=!arraysEqual(o,s)&&!o.includes(a),e)?tcart_newDelivery.renderServices(t.postalCode):($(".t706 #delivery-services-wrapper").find(".t-radio__control").each(function(e,t){$(t).remove()}),r.forEach(function(e,t){if(e.currency&&e.currency!==i.deliveryState.currencyCode)console.error(e.title+": wrong delivery currency ("+e.currency+")");else{i.deliveryState.services[e.id]={},i.deliveryState.services[e.id].fields=e.fields,i.deliveryState.services[e.id].strongAddress=e.strongAddress;var r,s=e.hint||"",o=e.title||"",d=e.minimumPrice||"",n=e.freeDeliveryThreshold||"",l=i.declOfNum(e.minimumDeliverTime,[tcart__dict(25,"day"),tcart__dict(26,"days"),tcart__dict(26,"days")]);e.staticPrice&&e.minimumDeliverTime?r=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+l+", "+tcart__showPrice(e.staticPrice):e.staticPrice?r=tcart__showPrice(e.staticPrice):e.minimumDeliverTime&&e.minimumPrice?r=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+l+", "+tcart__dict(27,"from")+" "+tcart__showPrice(e.minimumPrice):e.minimumPrice?r=tcart__dict(27,"from")+" "+tcart__showPrice(e.minimumPrice):e.minimumDeliverTime&&(r=tcart__dict(27,"from")+" "+e.minimumDeliverTime+" "+l),"delivery"===e.type&&(d="");var c="";"n"===e.cash&&(c+="cash");var u=!1;e.id===a&&(u=!0);var p=tcart_newDelivery.createRadio(o,r,d,e.type,null,e.id,t,e.staticPrice,s,e.hash,c,u,n);$("#delivery-services-wrapper").append(p)}}),d="object"==typeof t.postalCode?t.cityPostalCode:t.postalCode,$.when(tcart_newDelivery.getDeliveryPrice(t.projectId,d,a)).done(function(e){if(e.error&&console.error(e.error),e.hash&&tcart_newDelivery.setHashInput(e.hash),e.price){var t=e.price;tcart_newDelivery.updatePriceValueInRadio(t,a)}tcart__updateDelivery(),tcart_newDelivery.changeDeliveryTypeListener(),$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),tcart__showDeliveryPrice()}))})},500)}var tcart_newDelivery={deliveryState:{currentRequest:null,projectId:null,city:{},services:{},searchboxes:{},focusoutTimers:{},cityCoordinates:null,ymapApiKey:null,cityGuid:null,streetGuid:null,currencyCode:null,pickupList:null,postalCode:null,staticCities:null,geoData:null,autocompleteData:{cities:null},badResponseCounters:{services:0},activeServiceUid:null,freeDeliveryThreshold:null,fullNames:{city:"",street:"",house:"",pickup:""}},init:function(e){console.log("NEW DELIVERY INIT"),window.tcart_newDeliveryActive=!0,this.deliveryState.projectId=parseInt($("#allrecords").attr("data-tilda-project-id"),10),this.deliveryState.currencyCode=$(".t706").attr("data-project-currency-code"),this.deliveryState.ymapApiKey=e,this.deliveryState.ymapApiKey&&this.mapAppendScript("",e);var t=this,r=$(".t-radio__wrapper-delivery").first();$(".t-radio__wrapper-delivery").length>0&&$(".t-radio__wrapper-delivery").html(""),r.attr("id","customdelivery");var a=tcart_newDelivery.createTitle(tcart__dict(30,"Delivery"));r.append(a),this.appendStyleFromSettings(),$.when(this.getCityFromGeo(this.deliveryState.projectId)).then(function(e){if(e){var a=tcart_newDelivery.createInput("",tcart__dict(23,"City"),null,null,null,null,"searchbox-input load js-tilda-rule","tildadelivery-city",null,null,!0,null,"chosevalue"),i=t.createSearchbox(a,"city-searchbox"),s=tcart_newDelivery.createInput("","",null,null,null,null,"","tildadelivery-postalcode",!0),o=tcart_newDelivery.createInput("","hash",null,null,null,null,"","tildadelivery-hash",!0),d=tcart_newDelivery.createInput("","country",null,null,null,null,"","tildadelivery-country",!0);r.append(s),r.append(o),r.append(d),r.append(i.outerHTML),t.searchboxInit("city-searchbox","city");var n,l=document.createElement("div");if(l.id="delivery-services-wrapper",r.append(l),t.deliveryState.geoData=e,e.cities?(n=e.cities[0],t.deliveryState.staticCities=e.cities):n=e,n&&(t.deliveryState.city=n,t.deliveryState.cityGuid=n.guid,t.deliveryState.countryIso=n.countryIso,t.deliveryState.postalCode=n.postalCode,t.deliveryState.cityPostalCode=n.postalCode),""!==n.name)$("#city-searchbox").find(".t-input-description").html(n.fullName),$('[name="tildadelivery-country"]').val(n.countryIso),t.deliveryState.ymapApiKey&&$.when(t.getCityCoordinates("yandex",n.name)).done(function(e){var r;try{r=e.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "),r&&(r=[r[1],r[0]],t.deliveryState.cityCoordinates=r)}catch(e){console.error(e)}}),t.deliveryState.searchboxes["city-searchbox"]||(t.deliveryState.searchboxes["city-searchbox"]={}),t.deliveryState.searchboxes["city-searchbox"].address=n,t.deliveryState.fullNames.city=n.fullName,$('input[name="tildadelivery-city"]').val(n.name),$('input[name="tildadelivery-city"]').attr("data-option-selected",!0),t.setPostalCodeInput(n.postalCode),t.renderServices(n.postalCode);else{var c=$(".t706 #city-searchbox input");c.removeClass("load").attr("readonly",!1)}}},function(){var e=tcart_newDelivery.createInput("",tcart__dict(22,"Commentary"),tcart__dict(41,"Delivery data for manager"),null,null,null,"","delivery-badresponse-comment",null,null,!0),t=tcart__dict(42,'Unfortunately, the delivery service is currently unavailable. Please indicate the delivery address in a free form in the "Comment" field, the store manager will contact you shortly on the contact information provided'),a='<div style="margin: 20px 0; line-height: 22px; color: red;" class="t-text">';a+=t,a+="</div>",window.tcart&&(window.tcart.system="none"),r.append(a),r.append(e)}),$(document).keydown(function(e){77==e.keyCode&&console.log(t.deliveryState)}),$(document).on("click",".t-input-clear",function(){var e=$(this).closest(".searchbox-wrapper").attr("id");$("#"+e).find(".searchbox-list").html("");var r=t.deliveryState.focusoutTimers[e];clearTimeout(r),$(this).siblings(".searchbox-input").val(""),$(this).closest(".t-input-block").removeClass("active"),$(this).siblings(".searchbox-input").focus(),t.deliveryState.searchboxes[e]&&t.deliveryState.searchboxes[e].address&&(t.deliveryState.searchboxes[e].address=null)}),$(document).on("click",".searchbox-change-pickup",function(){var e=$(this).closest(".searchbox-wrapper");e.removeClass("show-info")}),this.renderFullAddressNode()},appendStyleFromSettings:function(){var e=document.querySelector("script"),t=$(".t706 .t-form__inputsbox .t-input-group").find('input[type="text"]').first(),r="";if(t.length){var a=t[0],i=t.hasClass("t-input_bbonly");i&&(r+="outline: none; padding-left: 0!important; padding-right: 0!important; border-top: 0!important; border-right: 0!important; border-left: 0!important; background-color: transparent!important; border-radius: 0!important;"),r+=a.style.cssText}else r+="color: #000000; border: 1px solid #000000;";var s=document.createElement("style");s.innerHTML=".t706 .t-form__inputsbox #customdelivery .t-input {"+r+"}",e.parentNode.insertBefore(s,e);var o=$(".t706 .t-form__inputsbox .t-input-group").find(".t-input-title").first();if(o.length){var d=o[0],n="";n+=d.style.cssText;var l=document.createElement("style");l.innerHTML=".t706 .t-form__inputsbox #customdelivery .t-input-title {"+n+"}",e.parentNode.insertBefore(l,e)}},disableChoseServiceControls:function(){$('.t706 input[name="tildadelivery-type"]').attr("disabled","disabled")},enableChoseServiceControls:function(){$('.t706 input[name="tildadelivery-type"]').attr("disabled",!1)},getFullAddress:function(){var e=this.deliveryState.fullNames,t="";return e.pickup?t+=e.city+", "+e.pickup:e.street&&(t+=e.city+", "+e.street),e.house&&(t+=" "+e.house),t},renderFullAddressNode:function(){var e=document.createElement("div");e.classList.add("delivery-full-address"),e.classList.add("t-descr");var t=document.querySelector(".t706__cartwin-totalamount-info");$(t).after(e)},setFullAddress:function(e){var t=document.querySelector(".delivery-full-address");t.innerHTML=e},changeCartInputsHandler:function(){var e=$(".t706"),t=this;e.find("input").on("change",function(){t.fillTcartDelivery()})},fillTcartDelivery:function(){var e=["city","street","pickup-name","pickup-address","pickup-id","house","entrance","floor","aptoffice","phone","entrancecode","comment","service-id","hash","postalcode","country","userinitials","onelineaddress"],t=$(".t706");e.forEach(function(e){var r="",a="tildadelivery-"+e;switch(e){case"service-id":r=t.find('[name="tildadelivery-type"]:checked').attr("data-service-id");break;case"pickup-id":r=t.find("[data-pickup-id]").attr("data-pickup-id");break;case"pickup-address":r=t.find("[data-pickup-address]").attr("data-pickup-address");break;default:r=t.find("[name="+a+"]").val()}r&&window.tcart.delivery&&(window.tcart.delivery[e]=r)})},mapAppendScript:function(e,t){var r=document.createElement("script");r.src="https://api-maps.yandex.ru/2.1/?apikey="+t+"&lang=ru_RU",$("head").append(r)},mapInit:function(e){switch(e){case"yandex":if(void 0!==window.ymaps){var t=document.createElement("div");t.id="delivery-yandex-map",$("#pickup-searchbox .searchbox-inner-wrapper").append(t);var r=this;window.ymaps.ready(function(){window.deliveryMap=new ymaps.Map("delivery-yandex-map",{center:r.deliveryState.cityCoordinates||[55.76,37.64],zoom:8,controls:["zoomControl"],maxZoom:20},{yandexMapDisablePoiInteractivity:!0})})}}},mapAddPoints:function(e,t,r){var a=this;void 0!==window.ymaps&&window.ymaps.ready(function(){window.deliveryMap.geoObjects&&window.deliveryMap.geoObjects.removeAll();var e=[];t.forEach(function(t){0===t.coordinates[0]&&0===t.coordinates[1]||e.push(t.coordinates)});for(var i=new ymaps.Clusterer({preset:"islands#circleIcon",groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),s=function(e){var i=t[e],s=i.name,o=i.address||"",d=i.workTime||"",l=i.phones||"",c=i.addressComment||"",u="",p="";p+="<b>"+s+"</b>";var v="";v+="<b>"+tcart__dict(31,"Address")+": </b>"+o+"</br>";var y="";return i.cash&&"n"===i.cash&&(y+="cash"),v+='<div style="margin: 10px 0;" class="delivery-map-point-select" '+(y?'data-restrictions="'+y+'"':"")+" data-point-index="+e+' onclick="window.tcart__chosePointOnMap(this); return false;">'+tcart__dict(37,"Select")+"</div>",v+=c?c+"</br>":"",v+=d?"<b>"+tcart__dict(40,"Working hours")+": </b>"+d+"</br>":"",l.length&&(u=l.length>1?"<b>"+tcart__dict(38,"Phones")+": </b>":"<b>"+tcart__dict(39,"Phone")+": </b>",v+=u+l.join(", ")+"</br>"),window.tcart__chosePointOnMap=function(e){n=e.dataset.pointIndex;var i=t[n],s=r.find(".searchbox-input"),o=r.attr("id");tcart__inputErrorHandler.hide(s),a.deliveryState.searchboxes[o]||(a.deliveryState.searchboxes[o]={}),s.attr("data-option-selected",!0),a.deliveryState.fullNames.pickup=i.address,a.deliveryState.postalCode=i.postalCode,a.setPostalCodeInput(i.postalCode),a.changePickupHandler(i.id,i.name,i.postalCode,r,i.address),$('.706 [name="tildadelivery-pickup-name"]').val(i.name),a.fillTcartDelivery(),window.deliveryMap.balloon.close(),a.showPickupInfo(i.id,r),a.hidePaymentMethod(e)},{balloonContentHeader:p,balloonContentBody:v,balloonContentFooter:""}},o=function(e){return{preset:"islands#circleIcon",index:e}},d=[],n=0,l=e.length;n<l;n++)d[n]=new ymaps.Placemark(e[n],s(n),o(n));i.options.set({gridSize:80,clusterDisableClickZoom:!1}),i.add(d),window.deliveryMap.geoObjects.add(i),window.deliveryMap.setBounds(i.getBounds(),{checkZoomRange:!0}).then(function(){window.deliveryMap.getZoom()>20&&window.deliveryMap.setZoom(18)},this)})},setPostalCodeInput:function(e){var t=$(".t706");t.find('input[name="tildadelivery-postalcode"]').val(e)},setHashInput:function(e){var t=$(".t706");t.find('input[name="tildadelivery-hash"]').val(e)},createSearchbox:function(e,t){var r=document.createElement("div");$(r).addClass("searchbox-wrapper"),$(r).attr("id",t);var a=document.createElement("div");$(a).addClass("searchbox-inner-wrapper"),$(a).append(e);var i=document.createElement("div");$(i).addClass("searchbox-list"),$(a).append(i),$(r).append(a);var s=document.createElement("div");return $(s).addClass("searchbox-info"),$(r).append(s),r},searchboxInit:function(e,t){var r,a=$("#"+e),i=$(a).find(".searchbox-input"),s=i.closest(".t-input-block"),o=this;$(i).on("paste keyup",function(d){var n=d;clearTimeout(r),o.deliveryState.searchboxes[e]&&(o.deliveryState.searchboxes[e].address=null),o.deliveryState.searchboxes[e]&&"pickup"!==t&&(o.deliveryState.searchboxes[e].autocompleteAddress=null),""===i.val()||s.hasClass("active")||s.addClass("active"),r=setTimeout(function(){o.changeSearchboxInputHandler(n,a,t),r=null},500)}),$(i).on("focusout",function(){clearTimeout(r),o.focusoutSearchboxInputHandler(a,t)}),$(i).on("click",function(e){clearTimeout(r),o.clickSearchboxInputHandler(e,a,t)})},clickSearchboxInputHandler:function(e,t,r){var a=$(t).find(".searchbox-input"),i=a.closest(".t-input-block");if(""===a.val()||i.hasClass("active")||i.addClass("active"),!($(t).find(".searchbox-list-item").length>0||a.hasClass("load"))){t.unbind();var s,o,d=parseInt(a.attr("data-service-id"));d&&(s=this.deliveryState.services[d].strongAddress);var n=this,l=$(t).find(".searchbox-list"),c=t.attr("id");this.deliveryState.searchboxes[c]&&"pickup"!==r&&(this.deliveryState.searchboxes[c].autocompleteAddress=null);var u,p,v,y=e.target.value;switch(t.hasClass("load")||(o=setTimeout(function(){t.addClass("load").attr("readonly",!0)},500)),r){case"city":if(u={pattern:y},u=JSON.stringify(u),n.deliveryState.searchboxes[c]&&(n.deliveryState.searchboxes[c].autocompleteAddress||n.deliveryState.staticCities)){if(clearTimeout(o),t.removeClass("load").attr("readonly",!1),v=n.deliveryState.staticCities||n.deliveryState.searchboxes[c].autocompleteAddress,v.error||0===v.length)return void(""!==a.val()?l.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):l.html(""));n.deliveryState.searchboxes[c].autocompleteAddress=v[0],n.deliveryState.searchboxes[c].addresses=v,n.deliveryState.autocompleteData.cities=v,n.fillSearchList(l,v,"address"),n.choseSearchListItemHandler(t,r)}else $.when(n.getAddresses(u,r)).done(function(e){clearTimeout(o),t.removeClass("load").attr("readonly",!1),e.error||0===e.length?""!==a.val()?l.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):l.html(""):(n.deliveryState.searchboxes[c].autocompleteAddress=e[0],n.deliveryState.searchboxes[c].addresses=e,n.deliveryState.autocompleteData.cities=e,n.fillSearchList(l,e,"address"),n.choseSearchListItemHandler(t,r))});break;case"pickup":if(p=$(a).attr("data-service-id"),n.deliveryState.searchboxes[c]&&n.deliveryState.searchboxes[c].autocompleteAddress){if(clearTimeout(o),t.removeClass("load").attr("readonly",!1),v=n.deliveryState.searchboxes[c].autocompleteAddress,v.error||0===v.length){l.html("");var h=window.tildaBrowserLang.toLowerCase(),m=v.userFriendlyError?v.userFriendlyError[h]?v.userFriendlyError[h]:v.userFriendlyError.en:"";return void(v.error&&tcart__errorHandler.show(m||v.error))}v=v.filter(function(e){return-1!==e.name.toLowerCase().indexOf(y.toLowerCase())||-1!==e.address.toLowerCase().indexOf(y.toLowerCase())}),n.deliveryState.searchboxes[c]||(n.deliveryState.searchboxes[c]={}),n.fillSearchList(l,v,"pickup"),n.choseSearchListItemHandler(t,r)}else $.when(n.getPickupList(n.deliveryState.projectId,n.deliveryState.city.postalCode,p,y)).done(function(e){if(clearTimeout(o),t.removeClass("load").attr("readonly",!1),e.error||0===e.length){""!==a.val()?l.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):l.html("");var i=window.tildaBrowserLang.toLowerCase(),s=e.userFriendlyError?e.userFriendlyError[i]?e.userFriendlyError[i]:e.userFriendlyError.en:"";e.error&&tcart__errorHandler.show(s||e.error)}else n.deliveryState.searchboxes[c]||(n.deliveryState.searchboxes[c]={}),n.deliveryState.searchboxes[c].autocompleteAddress=e,n.deliveryState.pickupList=e,n.fillSearchList(l,e,"pickup"),n.choseSearchListItemHandler(t,r)});break;case"street":u={pattern:y,fias:this.deliveryState.cityGuid},u=JSON.stringify(u),n.deliveryState.searchboxes[c]||(n.deliveryState.searchboxes[c]={}),s&&"street"===r&&a.attr("data-option-selected",!1),$.when(n.getAddresses(u,r)).done(function(e){clearTimeout(o),t.removeClass("load").attr("readonly",!1),e.error||0===e.length?""!==a.val()?l.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):l.html(""):(n.deliveryState.searchboxes[c].autocompleteAddress=e[0],n.fillSearchList(l,e,"address"),n.choseSearchListItemHandler(t,r))});break;case"house":u={pattern:y,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},u=JSON.stringify(u),$.when(n.getAddresses(u,r)).done(function(e){clearTimeout(o),t.removeClass("load").attr("readonly",!1),e.error||0===e.length?l.html(""):(n.deliveryState.searchboxes[c]||(n.deliveryState.searchboxes[c]={}),n.deliveryState.searchboxes[c].autocompleteAddress=e[0],n.fillSearchList(l,e,"address"),n.choseSearchListItemHandler(t,r))});break;default:clearTimeout(o),t.removeClass("load").attr("readonly",!1)}}},changeSearchboxInputHandler:function(e,t,r){t.unbind();var a,i,s=this,o=$(t).find(".searchbox-list"),d=$(t).find(".searchbox-input"),n=d.closest(".t-input-block"),l=t.attr("id"),c=parseInt(d.attr("data-service-id"));if(c&&(a=this.deliveryState.services[c].strongAddress),!d.hasClass("load")){var u,p,v=e.target.value;switch(t.hasClass("load")||(i=setTimeout(function(){t.addClass("load").attr("readonly",!0)},50)),""==d.val()&&n.removeClass("active"),r){case"city":if(u={pattern:v},u=JSON.stringify(u),s.deliveryState.searchboxes[l]||(s.deliveryState.searchboxes[l]={}),s.deliveryState.searchboxes[l]&&s.deliveryState.staticCities){if(clearTimeout(i),t.removeClass("load").attr("readonly",!1),p=s.deliveryState.staticCities,Array.isArray(p)?p=p.filter(function(e){return-1!==e.name.toLowerCase().indexOf(v.toLowerCase())||-1!==e.fullName.toLowerCase().indexOf(v.toLowerCase())}):console.log(p),0===p.length)return void(""!==d.val()?o.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):o.html(""));s.deliveryState.searchboxes[l].autocompleteAddress=p[0],s.deliveryState.searchboxes[l].addresses=p,s.deliveryState.autocompleteData.cities=p,s.fillSearchList(o,p,"address"),s.choseSearchListItemHandler(t,r)}else $.when(s.getAddresses(u,r)).done(function(e){clearTimeout(i),t.removeClass("load").attr("readonly",!1),e.error||0===e.length?""!==d.val()?o.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):o.html(""):(s.deliveryState.searchboxes[l].autocompleteAddress=e[0],s.deliveryState.searchboxes[l].addresses=e,s.deliveryState.autocompleteData.cities=e,s.fillSearchList(o,e,"address"),s.choseSearchListItemHandler(t,r))});break;case"pickup":if(d.attr("data-option-selected",!1),s.deliveryState.searchboxes[l]&&s.deliveryState.searchboxes[l].autocompleteAddress){if(clearTimeout(i),t.removeClass("load").attr("readonly",!1),p=s.deliveryState.searchboxes[l].autocompleteAddress,p=p.filter(function(e){return-1!==e.name.toLowerCase().indexOf(v.toLowerCase())||-1!==e.address.toLowerCase().indexOf(v.toLowerCase())}),0===p.length)return void(""!==d.val()?o.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):o.html(""));s.fillSearchList(o,p,"pickup"),s.choseSearchListItemHandler(t,r)}break;case"street":u={pattern:v,fias:this.deliveryState.cityGuid},u=JSON.stringify(u),s.deliveryState.searchboxes[l]||(s.deliveryState.searchboxes[l]={}),a&&d.attr("data-option-selected",!1),$.when(s.getAddresses(u,r)).done(function(e){clearTimeout(i),t.removeClass("load").attr("readonly",!1),e.error||0===e.length?""!==d.val()?o.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):o.html(""):(s.deliveryState.searchboxes[l].autocompleteAddress=e[0],s.deliveryState.searchboxes[l].addresses=e,s.fillSearchList(o,e,"address"),s.choseSearchListItemHandler(t,r))});break;case"house":u={pattern:v,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},u=JSON.stringify(u),s.deliveryState.searchboxes[l]||(s.deliveryState.searchboxes[l]={}),$.when(s.getAddresses(u,r)).done(function(e){clearTimeout(i),t.removeClass("load").attr("readonly",!1),e.error||0===e.length?""!==d.val()?o.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+tcart__dict(45,"No results were found for your request")+"</div>"):o.html(""):(s.deliveryState.searchboxes[l].autocompleteAddress=e[0],s.deliveryState.searchboxes[l].addresses=e,s.fillSearchList(o,e,"address"),s.choseSearchListItemHandler(t,r))})}}},choseSearchListItemHandler:function(e,t){var r,a,i,s=e.attr("id"),o=$(e).find(".searchbox-input"),d=$(e).find(".t-input-description"),n=$(e).find(".searchbox-list"),l=$(e).find(".searchbox-list-item"),c=this,u=o.closest(".t-input-block");tcart__inputErrorHandler.hide(o),l.on("click",function(l){switch(u.removeClass("active"),a=c.deliveryState.focusoutTimers[s],clearTimeout(a),r=l.target.dataset.postalcode,c.deliveryState.postalCode=r,c.setPostalCodeInput(r),c.deliveryState.searchboxes[s]||(c.deliveryState.searchboxes[s]={}),t){case"city":o.addClass("load").attr("readonly",!0),tcart__errorHandler.hide(),o.val(l.target.dataset.name),d.html(l.target.dataset.fullName),$('.t706 [name="tildadelivery-country"]').val(l.target.dataset.countryIso),o.attr("data-guid",l.target.dataset.guid),c.deliveryState.ymapApiKey&&$.when(c.getCityCoordinates("yandex",l.target.dataset.name)).done(function(e){var t;try{t=e.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "),t&&(t=[t[1],t[0]],c.deliveryState.cityCoordinates=t)}catch(e){console.error(e)}}),c.deliveryState.searchboxes[s].address={name:l.target.dataset.name,postalCode:r,guid:l.target.dataset.guid},c.deliveryState.city={name:l.target.dataset.name,fullName:l.target.dataset.fullName,postalCode:r,guid:l.target.dataset.guid},c.deliveryState.cityPostalCode=r;var p=c.deliveryState.autocompleteData.cities.find(function(e){return e.guid==l.target.dataset.guid});c.deliveryState.geoData=p,c.deliveryState.cityGuid=l.target.dataset.guid,c.deliveryState.streetGuid=null,c.deliveryState.fullNames={},c.deliveryState.fullNames.city=l.target.dataset.fullName,$("#delivery-services-wrapper").html(""),c.renderServices(r);break;case"street":i=parseInt(o.attr("data-service-id")),o.val(l.target.dataset.shortname),o.attr("data-guid",l.target.dataset.guid),c.deliveryState.searchboxes[s].address={name:l.target.dataset.name,shortName:l.target.dataset.shortname,postalCode:r,guid:l.target.dataset.guid},c.deliveryState.streetGuid=l.target.dataset.guid,c.deliveryState.fullNames.street=l.target.dataset.shortname,c.deliveryState.fullNames.house=null,c.clearHouseInput(),$.when(c.getDeliveryPrice(c.deliveryState.projectId,r,i)).done(function(e){if(e.error||0===e.length){var t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"";e.error&&tcart__errorHandler.show(r||e.error)}else{if(e.hash&&c.setHashInput(e.hash),e.price){var a=e.price;c.updatePriceValueInRadio(a,i)}c.setFullAddress(c.getFullAddress()),tcart__showDeliveryPrice()}});break;case"pickup":var v=l.target.dataset.coordinates.split(",");c.hidePaymentMethod(l.target),c.changePickupHandler(l.target.dataset.pickupid,l.target.dataset.name,r,e,l.target.dataset.address,v),c.deliveryState.searchboxes[s].address={name:l.target.dataset.name,pickupid:l.target.dataset.pickupid,postalCode:r},c.deliveryState.fullNames[t]=l.target.dataset.address,c.showPickupInfo(l.target.dataset.pickupid,e);break;case"house":i=parseInt(o.attr("data-service-id")),o.val(l.target.dataset.name),c.deliveryState.searchboxes[s].address={postalCode:r},c.deliveryState.fullNames[t]=l.target.dataset.name,$.when(c.getDeliveryPrice(c.deliveryState.projectId,r,i)).done(function(e){if(e.error||0===e.length){var t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"";e.error&&tcart__errorHandler.show(r||e.error)}else{if(e.hash&&c.setHashInput(e.hash),e.price){var a=e.price;c.updatePriceValueInRadio(a,i)}c.setFullAddress(c.getFullAddress()),tcart__showDeliveryPrice()}})}n.html(""),o.attr("data-option-selected",!0)})},focusoutSearchboxInputHandler:function(e,t){var r,a,i,s=this,o=$(e).find(".searchbox-list"),d=$(e).find(".t-input-description"),n=e.attr("id"),l=$(e).find(".searchbox-input"),c=l.closest(".t-input-block"),u=parseInt(l.attr("data-service-id"));u?(i=this.deliveryState.services[u].strongAddress,l.attr("data-option-selected",!1)):l.attr("data-option-selected",!0),this.deliveryState.focusoutTimers[n]=setTimeout(function(){if(c.removeClass("active"),s.deliveryState.searchboxes[n]&&s.deliveryState.searchboxes[n].address)return tcart__inputErrorHandler.hide(l),void o.html("");switch(t){case"city":if(s.deliveryState.searchboxes[n]&&s.deliveryState.searchboxes[n].autocompleteAddress&&l.val()===s.deliveryState.searchboxes[n].autocompleteAddress.name){l.addClass("load").attr("readonly",!0),a=s.deliveryState.searchboxes[n].autocompleteAddress,s.deliveryState.searchboxes[n].address=a,tcart__inputErrorHandler.hide(l),s.deliveryState.ymapApiKey&&$.when(s.getCityCoordinates("yandex",a.name)).done(function(e){var t;try{t=e.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "),t&&(t=[t[1],t[0]],s.deliveryState.cityCoordinates=t)}catch(e){console.error(e)}}),r=a.postalCode,s.deliveryState.postalCode=r,s.setPostalCodeInput(r),$('[name="tildadelivery-country"]').val(a.countryIso),l.val(a.name),d.html(a.fullName),l.attr("data-guid",a.guid),s.deliveryState.city.name=a.name,s.deliveryState.city.fullName=a.fullName,s.deliveryState.city.postalCode=r,s.deliveryState.city.guid=a.guid,s.deliveryState.cityPostalCode=r,s.deliveryState.cityGuid=a.guid,s.deliveryState.streetGuid=null,s.deliveryState.fullNames={},s.deliveryState.fullNames[t]=a.fullName;var p=s.deliveryState.autocompleteData.cities.find(function(e){return e.guid==a.guid});s.deliveryState.geoData=p,o.html(""),$("#delivery-services-wrapper").html(""),s.renderServices(r),l.attr("data-option-selected",!0)}else o.html(""),d.html(""),$("#delivery-services-wrapper").html(""),$("#addresses-wrapper").remove(),l.attr("data-option-selected",!1),s.deliveryState.streetGuid=null,s.deliveryState.fullNames={},tcart__inputErrorHandler.show(l,tcart__dict(35,"Please select an city from the options provided"));break;case"street":s.deliveryState.searchboxes[n]&&s.deliveryState.searchboxes[n].autocompleteAddress&&l.val()===s.deliveryState.searchboxes[n].autocompleteAddress.shortName?(a=s.deliveryState.searchboxes[n].autocompleteAddress,s.deliveryState.searchboxes[n].address=a,s.deliveryState.fullNames[t]=a.shortName,tcart__inputErrorHandler.hide(l),r=a.postalCode,s.deliveryState.postalCode=r,l.val(a.shortName),l.attr("data-guid",a.guid),s.deliveryState.streetGuid=a.guid,s.setPostalCodeInput(r),l.attr("data-option-selected",!0),o.html(""),$.when(s.getDeliveryPrice(s.deliveryState.projectId,r,u)).done(function(e){if(e.error||0===e.length){var t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"";e.error&&tcart__errorHandler.show(r||e.error)}else{if(e.hash&&s.setHashInput(e.hash),e.price){var a=e.price;s.updatePriceValueInRadio(a,u)}s.setFullAddress(s.getFullAddress()),tcart__showDeliveryPrice()}})):(i&&(l.attr("data-option-selected",!1),o.html(""),tcart__inputErrorHandler.show(l,tcart__dict(34,"Please select an address from the options provided"))),o.html("")),s.deliveryState.fullNames.house=null,s.clearHouseInput();break;case"house":s.deliveryState.searchboxes[n]&&s.deliveryState.searchboxes[n].autocompleteAddress&&l.val()===s.deliveryState.searchboxes[n].autocompleteAddress.name?(a=s.deliveryState.searchboxes[n].autocompleteAddress,s.deliveryState.searchboxes[n].address=a,s.deliveryState.fullNames[t]=a.name,tcart__inputErrorHandler.hide(l),r=a.postalCode,s.deliveryState.postalCode=r,l.val(a.name),l.attr("data-option-selected",!0),s.setPostalCodeInput(r),o.html(""),$.when(s.getDeliveryPrice(s.deliveryState.projectId,r,u)).done(function(e){if(e.error||0===e.length){var t=window.tildaBrowserLang.toLowerCase(),r=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"";e.error&&tcart__errorHandler.show(r||e.error)}else{if(e.hash&&s.setHashInput(e.hash),e.price){var a=e.price;s.updatePriceValueInRadio(a,u)}s.setFullAddress(s.getFullAddress()),tcart__showDeliveryPrice()}})):o.html("");break;case"pickup":o.html("");var v=null,y=null;s.deliveryState.searchboxes[n]&&s.deliveryState.searchboxes[n].autocompleteAddress&&(v=a=s.deliveryState.searchboxes[n].autocompleteAddress,v.forEach(function(e){e.name===l.val()&&(y=e)})),v&&y?(a=y,s.deliveryState.searchboxes[n].address=a,s.deliveryState.fullNames[t]=a.address,tcart__inputErrorHandler.hide(l),l.attr("data-option-selected",!0),s.changePickupHandler(a.id,a.name,a.postalCode,e,a.address,a.coordinates),s.setPostalCodeInput(a.postalCode),s.deliveryState.postalCode=a.postalCode,o.html("")):(l.attr("data-option-selected",!1),tcart__inputErrorHandler.show(l,tcart__dict(34,"Please select an address from the options provided")))}},200)},fillSearchList:function(e,t,r){var a,i,s,o=document.createElement("div");t.forEach(function(e){var t=document.createElement("div");switch($(t).addClass("searchbox-list-item t-text"),r){case"pickup":i=e.name,s=e.address;var d="";e.cash&&"n"===e.cash&&(d+="cash"),t.dataset.restrictions=d;break;case"address":if(e.fullName){i=e.fullName.split(",").reverse()[0];var n=e.fullName;n=n.split(",").reverse(),n.shift(),n=n.join(", "),s=n}else i=e.name,s=""}t.dataset.name=e.name,t.dataset.fullName=e.fullName||"",t.dataset.postalcode=e.postalCode,t.dataset.guid=e.guid||"",t.dataset.pickupid=e.id||"",t.dataset.shortname=e.shortName||"",t.dataset.address=e.address||"",t.dataset.coordinates=e.coordinates||"",t.dataset.countryIso=e.countryIso||""
;var l=document.createElement("div");l.classList.add("searchbox-list-item-text"),l.innerHTML=i,$(t).append(l),a=document.createElement("div"),a.classList.add("searchbox-list-item-description"),a.innerHTML=s,$(t).append(a),$(o).append(t)}),e.html(o.outerHTML),e.scrollTop(0)},showPickupInfo:function(e,t){var r,a=$(t).find(".searchbox-info");t.addClass("show-info"),this.deliveryState.pickupList.forEach(function(t){t.id!=e||(r=t)});var i=r.name,s=r.address||"",o=r.workTime||"",d=r.phones||"",n=r.addressComment||"",l="";l+='<p style="font-weight: 400; margin-bottom: 15px;" class="t-text">'+tcart__dict(33,"Pickup location")+":</p>",l+='<p class="t-text">'+i+"</p>",l+='<p class="t-text">'+tcart__dict(31,"Address")+": "+s+"</p>",n&&(l+='<p class="t-text" style="opacity: 0.6; line-height: 22px; font-size: .9rem;">'+n+"</p>"),l+=o?'<p class="t-text">'+tcart__dict(40,"Working hours")+": "+o+"</p>":"",d.length&&(l+=d.length>1?'<p class="t-text">'+tcart__dict(38,"Phones")+": "+d.join(", ")+"</p>":'<p class="t-text">'+tcart__dict(39,"Phone")+": "+d.join(", ")+"</p>"),l+='<span style="border-bottom: 1px dashed #000; font-weight: 400; margin-top: 10px; display: inline-block; cursor: pointer;" class="t-text searchbox-change-pickup">'+tcart__dict(46,"Change")+"</span>",a.html(l)},declOfNum:function(e,t){var r=[2,0,1,1,1,2];return t[e%100>4&&e%100<20?2:r[e%10<5?e%10:5]]},renderServices:function(e){this.deliveryState.services={},this.deliveryState.postalCode={},$("#delivery-services-wrapper").html(""),$("#addresses-wrapper").remove();var t=this.deliveryState.cityPostalCode||"",r=this,a=this.deliveryState.currencyCode,i=$(".t706 #city-searchbox input"),s=$(".t-radio__wrapper-delivery").first();$.when(this.getServices(this.deliveryState.projectId,t,a)).then(function(e){if(e.error){var t=window.tildaBrowserLang.toLowerCase(),a=e.userFriendlyError?e.userFriendlyError[t]?e.userFriendlyError[t]:e.userFriendlyError.en:"";return tcart__errorHandler.show(a||e.error),window.tcart.emtpyDeliveryServices=!0,void i.removeClass("load").attr("readonly",!1)}0===e.length?(window.tcart.emtpyDeliveryServices=!0,tcart__errorHandler.show(tcart__dict(29,"Unfortunately, delivery to your chosen city is not possible")),i.removeClass("load").attr("readonly",!1)):window.tcart.emtpyDeliveryServices=!1,e.forEach(function(t,a){if(t.currency&&t.currency!==r.deliveryState.currencyCode){if(console.error(t.title+": wrong delivery currency ("+t.currency+")"),e.length===a+1){$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset");var i=$(".t706 #city-searchbox input");i.removeClass("load").attr("readonly",!1)}}else{r.deliveryState.services[t.id]={},r.deliveryState.services[t.id].fields=t.fields,r.deliveryState.services[t.id].strongAddress=t.strongAddress;var s,o=t.hint||"",d=t.title||"",n=t.minimumPrice||"",l=!1,c=t.freeDeliveryThreshold||"",u=r.declOfNum(t.minimumDeliverTime,[tcart__dict(25,"day"),tcart__dict(26,"days"),tcart__dict(26,"days")]);t.staticPrice&&t.minimumDeliverTime?s=tcart__dict(27,"from")+" "+t.minimumDeliverTime+" "+u+", "+tcart__showPrice(t.staticPrice):t.staticPrice?s=tcart__showPrice(t.staticPrice):t.minimumDeliverTime&&t.minimumPrice?s=tcart__dict(27,"from")+" "+t.minimumDeliverTime+" "+u+", "+tcart__dict(27,"from")+" "+tcart__showPrice(t.minimumPrice):t.minimumPrice?s=tcart__dict(27,"from")+" "+tcart__showPrice(t.minimumPrice):t.minimumDeliverTime&&(s=tcart__dict(27,"from")+" "+t.minimumDeliverTime+" "+u),"delivery"===t.type&&(n="");var p="";"n"===t.cash&&(p+="cash"),0===a&&(l=!0);var v=tcart_newDelivery.createRadio(d,s,n,t.type,null,t.id,a,t.staticPrice,o,t.hash,p,l,c);$("#delivery-services-wrapper").append(v)}}),tcart__updateDelivery(),tcart_newDelivery.changeDeliveryTypeListener(),$('#delivery-services-wrapper [checked="checked"]').trigger("change"),$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),tcart__showDeliveryPrice()},function(){if(r.deliveryState.badResponseCounters.services++,r.deliveryState.badResponseCounters.services<5)setTimeout(function(){r.renderServices(e)},1e3);else{tcart__preloader.hide();var t=tcart_newDelivery.createInput("",tcart__dict(22,"Commentary"),tcart__dict(41,"Delivery data for manager"),null,null,null,"","delivery-badresponse-comment",null,null,!0),a=tcart__dict(42,'Unfortunately, the delivery service is currently unavailable. Please indicate the delivery address in a free form in the "Comment" field, the store manager will contact you shortly on the contact information provided'),i='<div style="margin: 20px 0; line-height: 22px; color: red;" class="t-text">';i+=a,i+="</div>",window.tcart&&(window.tcart.system="none"),s.append(i),s.append(t)}})},getCityFromGeo:function(e){var t="https://geoserv.tildacdn.com/api/detect-city/",r={projectId:e};return r=JSON.stringify(r),$.ajax({type:"POST",url:t,dataType:"json",data:r,success:function(){},error:function(e){console.error(e)}})},getPayTypes:function(){var e=$("#allrecords").data("tilda-paytypes");try{if(!e||"object"!=typeof e&&"function"!=typeof e){if(e={},$("input[name=paymentsystem]").each(function(){"cash"==$(this).val()?e.cash="y":"banktransfer"==$(this).val()?e.banktransfer="y":e.card="y"}),!e.card&&!e.cash&&!e.banktransfer){var t=$(".t706").eq(0).data("payment-system");"cash"==t?e.cash="y":"banktransfer"==t?e.banktransfer="y":t&&""!=t&&"none"!=t?e.card="y":e.none="y"}$("#allrecords").data("tilda-paytypes",e)}}catch(e){}return e},getServices:function(e,t,r){var a="https://delivery.tildacdn.com/cart-api/",i=window.tcart.total;if(!i||i<1)return{error:new Error("items count is empty")};var s=window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,o=this.deliveryState.geoData||{},d=window.tcart.products||[],n=this.getPayTypes();t=t||0;var l={action:"list",projectId:e,postalCode:t,currency:r,itemsCount:i,cartAmount:s,geoData:o,products:d,paytypes:n};return l=JSON.stringify(l),tcart__preloader.show($("#delivery-services-wrapper"),tcart__dict(43,"Receiving delivery services")),tcart__hideDeliveryPrice(),$.ajax({type:"POST",url:a,data:l,dataType:"json",success:function(){tcart__preloader.hide()},error:function(e){console.error(e)}})},getPickupList:function(e,t,r,a){var i="https://delivery.tildacdn.com/cart-api/",s=this.deliveryState.geoData||{},o=window.tcart.total||0,d=window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,n=window.tcart.products||[],l=this.getPayTypes(),c={action:"pickup-list",projectId:e,postalCode:t,deliveryId:r,pattern:a,itemsCount:o,cartAmount:d,geoData:s,products:n,paytypes:l};return c=JSON.stringify(c),$.ajax({type:"POST",url:i,data:c,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getDeliveryPrice:function(e,t,r,a){tcart__hideDeliveryPrice();var i="https://delivery.tildacdn.com/cart-api/";t=t||0;var s=window.tcart.total||0,o=window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,d=window.tcart.products||[],n=this.deliveryState.cityGuid||0,l={action:"calculate",projectId:e,postalCode:t,deliveryId:r,currency:this.deliveryState.currencyCode,itemsCount:s,cartAmount:o,pickupPointId:a,products:d,guid:n};return l=JSON.stringify(l),$.ajax({type:"POST",url:i,data:l,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getCityCoordinates:function(e,t){var r="https://geocode-maps.yandex.ru/1.x/?apikey="+this.deliveryState.ymapApiKey+"&format=json&geocode="+t;return $.ajax({type:"GET",url:r,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getAddresses:function(e,t){var r,a=this;switch(this.deliveryState.currentRequest&&a.deliveryState.currentRequest.abort(),t){case"street":r="https://geoserv.tildacdn.com/api/address/";break;case"city":r="https://geoserv.tildacdn.com/api/city/";break;case"pickup":r="https://delivery.tildacdn.com/cart-api/";break;case"house":r="https://geoserv.tildacdn.com/api/house/"}return this.deliveryState.currentRequest=$.ajax({type:"POST",url:r,data:e,dataType:"json",success:function(){a.deliveryState.currentRequest=null},error:function(e){a.deliveryState.currentRequest=null}}),this.deliveryState.currentRequest},createInput:function(e,t,r,a,i,s,o,d,n,l,c,u,p){t=t||"",r=r||"",i=i||"",s=s||"",e=e||"",u=u||"",a=a||"",p=p||"",c=c?1:0,o=o+" t-input"||"t-input";var v="";return v+="<div "+(l?'style="'+l+'"':"")+" "+(n?"hidden":"")+' class="t-input-group t-input-group_in" data-input-lid="">',v+='<div class="t-input-title t-descr t-descr_md" data-redactor-toolbar="no" field="">'+t+"</div>",v+='<div class="t-input-block">',v+='<input class="'+o+'" '+(p?'data-tilda-rule="'+p+'"':"")+" "+(u?'inputmode="'+u+'"':"")+" "+(e?'type="'+e+'"':"")+' data-service-id="'+s+'" '+(i?'id="'+i+'"':"")+' name="'+d.toLowerCase()+'" value="'+a+'" placeholder="'+r+'" autocomplete="no" data-tilda-req='+c+" />",v+=' <svg class="t706__search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88"> <path fill="#3f3f3f" d="M85 31.1c-.5-8.7-4.4-16.6-10.9-22.3C67.6 3 59.3 0 50.6.6c-8.7.5-16.7 4.4-22.5 11-11.2 12.7-10.7 31.7.6 43.9l-5.3 6.1-2.5-2.2-17.8 20 9 8.1 17.8-20.2-2.1-1.8 5.3-6.1c5.8 4.2 12.6 6.3 19.3 6.3 9 0 18-3.7 24.4-10.9 5.9-6.6 8.8-15 8.2-23.7zM72.4 50.8c-9.7 10.9-26.5 11.9-37.6 2.3-10.9-9.8-11.9-26.6-2.3-37.6 4.7-5.4 11.3-8.5 18.4-8.9h1.6c6.5 0 12.7 2.4 17.6 6.8 5.3 4.7 8.5 11.1 8.9 18.2.5 7-1.9 13.8-6.6 19.2z"></path> </svg>',v+='<div class="t-input-clear"></div>',v+="</div>",v+='<div class="t-input-error"></div>',v+='<div class="t-input-description t-text t-text_xs" style="color: #505050; margin: 5px 0 0;"></div>',v+="</div>",v},createRadio:function(e,t,r,a,i,s,o,d,n,l,c,u,p){e=e||"",t=t||"",r=r||"",n=n||"",l=l||"",c=c||"",p=p||"",i=i?i+" t-radio__control t-text t-text_xs":"t-radio__control t-text t-text_xs",u&&(u='checked="checked"');var v="";v+='<label class="'+i+'" '+(s?'data-service-id="'+s+'"':"")+">";var y="<input "+(c?'data-restrictions="'+c+'"':"")+(p?'data-free-delivery-threshold="'+p+'"':"")+(l?'data-hash-value="'+l+'"':"")+" "+(n?'data-hint-text="'+n+'"':"")+" "+(d?'data-static-price="'+d+'"':"")+" "+(d?'data-delivery-price="'+d+'"':'data-delivery-price=""')+" "+u+' data-service-id="'+s+'"type="radio" data-delivery-type='+a+' name="tildadelivery-type" value=""class="t-radio t-radio_delivery js-tilda-rule" data-tilda-req="1">',h=jQuery.parseHTML(y);return $(h).attr("value",e),v+=$(h)[0].outerHTML,v+='<div class="t-radio__indicator" style="border-color:#000000"></div>',v+='<span class="delivery-checkbox-label">'+e+" </span>",v+='<span class="delivery-minimum">'+t+" </span>",v+="</label>",v},createTitle:function(e,t){e=e||"",t=t||"";var r="";return r+='<div class="t-name t-name_md'+t+'" style="margin: 20px 0;">'+e+"</div>",r},createSelect:function(e,t,r,a,i){e=e||"",t=t||"",i=i||"";var s="";return s+='<label class="t-input-title t-descr t-descr_md">Пункт выдачи</label>',s+='<div class="ss-select delivery-pickup-select">',s+='<select class="ss-input ss-select delivery-select" data-service-id="'+a+'" name="'+i+'">',s+='<option data-point-id="">Не выбран</option>',r.forEach(function(e){s+="<option data-point-id="+e.id+">"+e.address+"</option>"}),s+="</select>",s+="</div>",s},changeDeliveryTypeListener:function(){var e=this;$("input[data-delivery-type]").change(function(){var t=parseInt($(this).attr("data-service-id"),10)||0,r=parseInt($(this).attr("data-free-delivery-threshold"),10);e.deliveryState.freeDeliveryThreshold=r||0,e.deliveryState.activeServiceUid=t,tcart__errorHandler.hide(),e.renderAddressFields(this),this.dataset.hashValue&&e.setHashInput(this.dataset.hashValue),e.hidePaymentMethod(this),$("input[data-delivery-type]").each(function(e,t){$(t).attr("data-static-price")>0?$(t).attr("data-delivery-price",$(t).attr("data-static-price")):$(t).attr("data-delivery-price","")}),e.hints.deleteAll(),e.deliveryState.fullNames.pickup=null,e.deliveryState.fullNames.street=null,e.deliveryState.fullNames.house=null,e.deliveryState.searchboxes["pickup-searchbox"]&&(e.deliveryState.searchboxes["pickup-searchbox"]=null),$(this).attr("data-hint-text")&&e.hints.render($(this).attr("data-hint-text")),tcart__updateDelivery()})},hidePaymentMethod:function(e){var t=$(".t706").find("[data-payment-variant-system='cash']"),r=$(".t706").find("[data-payment-variant-system='cash']").parent(),a=r.closest(".t-radio__wrapper-payment"),i=a.find("[data-payment-variant-system]").not("[data-payment-variant-system='cash']").first();"cash"===e.dataset.restrictions&&t.length?(r.hide(),i.prop("checked",!0),i.trigger("change")):r.show()},updatePriceValueInRadio:function(e,t){$('.t706__cartwin input[data-service-id="'+t+'"]').attr("data-delivery-price",e),tcart__updateDelivery(),tcart__showDeliveryPrice()},changePickupHandler:function(e,t,r,a,i,s){var o=$(a).find(".searchbox-input"),d=o.attr("data-service-id"),n=this;if(r=r||this.deliveryState.city.postalCode,o.attr("data-pickup-id",e),o.attr("data-pickup-address",i),o.val(t),$.when(n.getDeliveryPrice(n.deliveryState.projectId,r,d,e)).done(function(t){var r=t.price;if(t.error||0===t.length){var a=window.tildaBrowserLang.toLowerCase(),i=t.userFriendlyError?t.userFriendlyError[a]?t.userFriendlyError[a]:t.userFriendlyError.en:"";t.error&&tcart__errorHandler.show(i||t.error)}else t.hash&&n.setHashInput(t.hash),e||(r=0),n.updatePriceValueInRadio(r,d),n.setFullAddress(n.getFullAddress())}),s)var l=0==s[0]&&0==s[1];s&&window.deliveryMap&&!l&&window.deliveryMap.setCenter(s,16)},renderAddressFields:function(e){this.disableChoseServiceControls();var t=this,r=$(".t-radio__wrapper-delivery").first();$("#addresses-wrapper").length>0&&$("#customdelivery").attr("data-service-id")!==$(e).attr("data-service-id")&&$("#addresses-wrapper").remove(),$("#customdelivery").attr("data-service-id",$(e).attr("data-service-id"));var a=document.createElement("div");a.id="addresses-wrapper",$(a).css("margin","20px 0"),r.append(a);var i=$(e).attr("data-delivery-type"),s=$(e).attr("data-service-id"),o=$(".t706 #city-searchbox input");switch(i){case"pickup":tcart__preloader.show($("#addresses-wrapper"),tcart__dict(44,"Getting a list of points of issue of orders")),$.when(t.getPickupList(t.deliveryState.projectId,t.deliveryState.city.postalCode,s)).done(function(e){if(e.error){var r=window.tildaBrowserLang.toLowerCase(),i=e.userFriendlyError?e.userFriendlyError[r]?e.userFriendlyError[r]:e.userFriendlyError.en:"";return tcart__errorHandler.show(i||e.error),tcart__preloader.hide(),t.enableChoseServiceControls(),void o.removeClass("load").attr("readonly",!1)}tcart__preloader.hide();var d=t.createInput("",tcart__dict(33,"Pickup location"),tcart__dict(24,"Select pickup location"),null,null,s,"searchbox-input js-tilda-rule","tildadelivery-pickup-name",null,null,!0,null,"chosevalue"),n=t.createSearchbox(d,"pickup-searchbox");$("#addresses-wrapper").append(n.outerHTML),t.deliveryState.searchboxes["pickup-searchbox"]={},t.deliveryState.searchboxes["pickup-searchbox"].autocompleteAddress=e,t.deliveryState.pickupList=e,t.deliveryState.ymapApiKey&&t.mapInit("yandex"),t.searchboxInit("pickup-searchbox","pickup",null,e),t.renderUserFields(a,s),t.changeCartInputsHandler();var l=$(".t706 #pickup-searchbox");t.deliveryState.ymapApiKey&&t.mapAddPoints("",e,l),t.enableChoseServiceControls(),o.removeClass("load").attr("readonly",!1)});break;case"delivery":t.renderUserFields(a,s),t.changeCartInputsHandler(),t.enableChoseServiceControls();o=$(".t706 #city-searchbox input");o.removeClass("load").attr("readonly",!1)}},clearHouseInput:function(){$('.t706 #customdelivery [name="tildadelivery-house"]').val("")},renderUserFields:function(e,t){var r=this.deliveryState.services[t].fields,a=0;for(var i in r)switch(i){case"street":case"comment":case"userInitials":break;default:a++}var s=0;for(var o in r){var d=r[o].autocomplete,n="",l="",c="",u="",p="",v=!0;switch(o){case"street":n=tcart__dict(15,"Street"),l="width: 100%";break;case"house":s++,n=tcart__dict(16,"House"),v=!1;break;case"entrance":s++,n=tcart__dict(17,"Entrance"),c="number",u="numeric",v=!1;break;case"floor":s++,n=tcart__dict(18,"Floor"),c="number",u="numeric",v=!1;break;case"aptOffice":s++,n=tcart__dict(19,"Apt/Office"),v=!1;break;case"phone":s++,n=tcart__dict(20,"Phone"),c="number",u="numeric";break;case"entranceCode":s++,n=tcart__dict(21,"Entrance code"),v=!1;break;case"comment":n=tcart__dict(22,"Comment"),l="width: 100%",v=!1,p=tcart__dict(36,"Order comment");break;case"oneLineAddress":s++,n=tcart__dict(31,"Address");break;case"userInitials":l="width: 100%",n=tcart__dict(47,"Initials"),p=tcart__dict(48,"Full name")}a===s&&a%2!=0&&(l="width: 100%"),n=n||"";var y="tildadelivery-"+o;if(d){var h="chosevalue";"house"===o&&(h="");var m=tcart_newDelivery.createInput(c,n,p,"","",t,"searchbox-input js-tilda-rule",y,!1,l,v,u,h),f=o+"-searchbox",_=this.createSearchbox(m,f);$(e).append(_),this.searchboxInit(f,o)}else{var b=tcart_newDelivery.createInput(c,n,p,"","",t,"js-tilda-rule",y,!1,l,v,u);$(e).append(b)}}},hints:{render:function(e){var t=$("#delivery-services-wrapper"),r=document.createElement("div");$(r).addClass("delivery-hint t-text t-text_xs"),r.innerHTML=e,$(t).append(r)},deleteAll:function(){$(".delivery-hint").length&&$(".delivery-hint").remove()}}},tcart__errorHandler={show:function(e){$(".t-form__errorbox-item.js-rule-error-string").html(e),$(".js-errorbox-all").css("display","block"),$(".t-form__errorbox-item.js-rule-error-string").css("display","block")},hide:function(){$(".js-errorbox-all").css("display","none"),$("t-form__errorbox-item.js-rule-error-string").css("display","none")}},tcart__inputErrorHandler={show:function(e,t){var r=e.closest(".t-input-group"),a=r.find(".t-input-error");a.html(t),r.addClass("js-error-control-box")},hide:function(e){var t=e.closest(".t-input-group"),r=t.find(".t-input-error");r.html(""),t.removeClass("js-error-control-box")}},tcart__preloader={show:function(e,t){if(e.length&&!e.parent().find(".tcart__preloader").length){var r="";r+='<div class="tcart__preloader" style="margin: 20px 0;">',t&&(r+='<div class="t-text" style="text-align: center; opacity: .5; font-size: 15px;">'+t+"</div>"),r+='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>',r+="</div>",e.before(r)}},hide:function(){$(".tcart__preloader").remove()}};